<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Салихов Марсель (marcel.salikhov@gmail.com)" />
  <meta name="date" content="2019-02-06" />
  <meta name="copyright" content="НИУ ВШЭ. Салихов Марсель (marcel.salikhov@gmail.com)"/>
  <title>Оптимизация инвестиционных портфелей   Количественные финансы</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link href="libs/slidy-2/styles/slidy.css" rel="stylesheet" />
  <script src="libs/slidy-2/scripts/slidy.js"></script>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
   href="styles.css" />
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Оптимизация инвестиционных портфелей <br> “Количественные финансы”</h1>
  <p class="author">
Салихов Марсель (<a href="mailto:marcel.salikhov@gmail.com">marcel.salikhov@gmail.com</a>)
  </p>
  <p class="date">2019-02-06</p>
</div>
<div id="-" class="slide section level2">
<h2>Цели лекции</h2>
<ul>
<li>изучить основы современной портфельной теории (портфельная теория Марковица)</li>
<li>понять, что такое безрисковая ставка<br />
</li>
<li>понять, как рассчитываются доходность и риск портфелей, состоящих рисковых и безрисковых активов</li>
<li>разобраться в преимуществах диверсификации</li>
<li>понять, что такое эффективная граница (effective frontier) и эффективный (оптимальный) портфель</li>
<li>понять, что такое тангенциальный портфель (tangency portfolio)</li>
<li>посчитать эффективный портфель, состоящий из акций 5 компаний (Газпром, Сбербанк, Норникель, Магнит, МТС)</li>
<li>понять ограничения оптимизации “риск/доходность” на практике</li>
</ul>
</div>
<div id="--" class="slide section level2">
<h2>Риск и доходность</h2>
<ul>
<li>Базовая концепция в финансах – это компромисс между риском и доходностью.</li>
<li>Если вам предлагают две инвестиции с одинаковым уровня ожидаемого риска, но разной ожидаемой доходностью, вы выберете вариант, который предлагает <strong>большую доходность</strong>.</li>
<li>Если две инвестиции предлагают одинаковый уровень ожидаемой доходности, но разный уровень риска, то вы выберете инвестицию с <strong>меньшим уровнем риска</strong>.</li>
<li>Но что делать, если вам надо распределить ваши свободные сбережения между 30 наиболее ликвидными бумагами, которые торгуются на российском (или на глобальном рынке) рынке. Как выбрать доли распределения в портфеле?</li>
<li>Оптимальное распределение долей в портфеле – задача <strong>asset allocation</strong> – важный вопрос. Основная часть отличий в риск/доходностях разных портфелей связаны именно с распределением долей, а не с различиями в доходностях отдельных активов.</li>
</ul>
</div>
<div id="--harry-markowitz----" class="slide section level2">
<h2>Гарри Марковиц (Harry Markowitz) – основатель современной портфельной теории</h2>
<ul>
<li><strong>Markowitz, H.M. (March 1952). “Portfolio Selection”. The Journal of Finance. 7 (1): 77–91</strong> – статья, которая заложила основы современной портфельной теории (modern portfolio theory).</li>
<li>Идеи MPT по сути привели к созданию всей отрасли пассивного инвестирования. В настоящее время индексные фонды управляют триллионами долларов.</li>
</ul>
<div align="center">
<p><img src="fig/harry-markowitz.jpg" width="850" height="565" /></p>
</div>
</div>
<div id="-----" class="slide section level2">
<h2>Корреляция и ковариация двух активов – пример</h2>
<p>Пусть у нас есть акции компаний - А и Б. Доходность акций компании А имеет проциклический характер, то есть растет, когда экономика на подъеме.</p>
<p>Доходность Б носит антициклический характер – уменьшается, когда экономика на подъеме, но растет, когда наступает спад.</p>
<p>Предположим, что у нас есть следующее распределение доходностей в зависимости от состояния экономики:</p>
<p><strong>Таблица. Предполагаемая доходность для акций компаний А и Б </strong></p>
<table>
<thead>
<tr class="header">
<th>Состояние экономики</th>
<th>Вероятность</th>
<th>Доходность А</th>
<th>Доходность Б</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Подъем</td>
<td>0,33</td>
<td>0,385</td>
<td>-0,225</td>
</tr>
<tr class="even">
<td>Нормальное</td>
<td>0,33</td>
<td>0,140</td>
<td>0,02</td>
</tr>
<tr class="odd">
<td>Спад</td>
<td>0,33</td>
<td>-0,105</td>
<td>0,265</td>
</tr>
</tbody>
</table>
<p><strong>Таблица. Расчет ожидаемой доходности для акций А </strong></p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Доходность</th>
<th>Отклонение от ожид. доходности</th>
<th>Отклонение в квадрате</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Подъем</td>
<td>0,385</td>
<td>0,245</td>
<td>0,060</td>
</tr>
<tr class="even">
<td>Нормальное</td>
<td>0,140</td>
<td>0,000</td>
<td>0,000</td>
</tr>
<tr class="odd">
<td>Спад</td>
<td>-0,105</td>
<td>-0,245</td>
<td>0,060</td>
</tr>
</tbody>
</table>
<p>Ожидаемая доходность = 1/3 (0,385 - 0,14 - 0,105) = 0,14</p>
<p>Дисперсия = 1/3 (0,060 + 0 + 0,060) = 0,04</p>
<p>Стандартное отклонение = 0,20</p>
<p><strong>Таблица. Расчет ожидаемой доходности для акций Б </strong></p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Доходность</th>
<th>Отклонение от ожид. доходности</th>
<th>Отклонение в квадрате</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Подъем</td>
<td>-0,225</td>
<td>-0,245</td>
<td>0,060</td>
</tr>
<tr class="even">
<td>Нормальное</td>
<td>0,020</td>
<td>0,000</td>
<td>0,000</td>
</tr>
<tr class="odd">
<td>Спад</td>
<td>0,265</td>
<td>0,245</td>
<td>0,060</td>
</tr>
</tbody>
</table>
<p>Ожидаемая доходность = 1/3 (-0,225 + 0,2 + 0,265) = 0,02</p>
<p>Дисперсия = 1/3 (0,060 + 0 + 0,060) = 0,04</p>
<p>Стандартное отклонение = 0,20</p>
</div>
<div id="-------" class="slide section level2">
<h2>Доходность портфеля из двух акций А и Б</h2>
<p>Пусть у нас есть 100 тыс. рублей, который мы поровну распределили между акциями А и Б (по 50 тыс. рублей).</p>
<p>Какова ожидаемая доходность и стандартное отклонение этого портфеля?</p>
<p><strong>Таблица. Доходность портфеля из акций А и Б </strong></p>
<table style="width:100%;">
<colgroup>
<col width="13%" />
<col width="9%" />
<col width="9%" />
<col width="24%" />
<col width="24%" />
<col width="19%" />
</colgroup>
<thead>
<tr class="header">
<th>Состояние экономики</th>
<th>Доходность А</th>
<th>Доходность Б</th>
<th>Доход от 50 тыс. рублей вложенных в А</th>
<th>Доход от 50 тыс. рублей вложенных в Б</th>
<th>Доход портфеля (50% А и 50% Б)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Подъем</td>
<td>0,385</td>
<td>-0,225</td>
<td>69,25</td>
<td>38,75</td>
<td>108,00</td>
</tr>
<tr class="even">
<td>Нормальное</td>
<td>0,140</td>
<td>0,020</td>
<td>57,00</td>
<td>51,00</td>
<td>108,00</td>
</tr>
<tr class="odd">
<td>Спад</td>
<td>-0,105</td>
<td>0,265</td>
<td>44,75</td>
<td>63,25</td>
<td>108,00</td>
</tr>
</tbody>
</table>
<p>Результат – независимо от состояния экономики доходность портфеля составляет 8%, стандартное отклонение = 0.</p>
<p>Любой риск исключен!</p>
</div>
<div id="-----" class="slide section level2">
<h2>Ковариация и корреляция А и Б</h2>
<p>Этот результат – полное исключение риска - связан с тем, что активы А и Б имеют абсолютную отрицательную корреляцию =-1.</p>
<p><strong>Таблица. Ковариация и корреляция А и Б </strong></p>
<table style="width:100%;">
<colgroup>
<col width="17%" />
<col width="27%" />
<col width="27%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th>Состояние экономики</th>
<th>Отклонение от ожид. доходности А</th>
<th>Отклонение от ожид. доходности Б</th>
<th>Произведение отклонений доходности</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Подъем</td>
<td>0,245</td>
<td>-0,245</td>
<td>-0,060025</td>
</tr>
<tr class="even">
<td>Нормальное</td>
<td>0,000</td>
<td>0,000</td>
<td>0</td>
</tr>
<tr class="odd">
<td>Спад</td>
<td>-0,245</td>
<td>0,245</td>
<td>-0,060025</td>
</tr>
</tbody>
</table>
<p>Ковариация = 1/3(-0,060025 + 0 + 0,060025) = -0,04</p>
<p>Корреляция = -0,04/(0,20 * 0,20) = -1</p>
</div>
<div id="---" class="slide section level2">
<h2>Ковариация и корреляция доходностей</h2>
<ul>
<li><strong>Ковариация</strong> позволяет определить, как изменяются доходности двух бумаг – в одном направлении (положительно), или в противоположных (отрицательно) направлениях.</li>
</ul>
<p><span class="math display">\[\sigma_{1,2} = \sum p_i (X_1 - E(X_1))(X_2 - E(X_2)) \]</span></p>
<p><strong>Корреляция</strong> – нормированная на произведение стандартных доходностей ковариация.</p>
<p><span class="math display">\[\rho = \frac{\sigma_{1,2}}{\sigma_1 \sigma_2} \]</span></p>
</div>
<div id="-" class="slide section level2">
<h2>Безрисковый актив</h2>
<ul>
<li><strong>Безрисковый актив</strong> – бумага, которая предлагает предсказуемую ставку доходности в выбранной валюте и в пределах горизонта данного инвестора.</li>
<li>Если брать общую ситуацию, когда нет конкретного инвестора, то безрисковыми активам следует считать те из них, которые предлагают предсказуемую доходность инвестору в пределах короткого периода принятия решения – торгового дня.</li>
<li>Если за расчетную единицу принят рубль, а период принятия решений – один рабочий день, то безрисковой ставкой доходности можно считать процентную ставку по коротким ОФЗ.</li>
<li>Другие альтернативные варианты безрисковой ставки в рублях – ставка по депозитам Сбербанка или других банков, ставка на рынке межбанковского кредитования (MIACR или другие).</li>
</ul>
</div>
<div id="------" class="slide section level2">
<h2>Портфель безрискового актива и единственного рискового актива</h2>
<ul>
<li>Пусть вы решили инвестировать 100 тыс. рублей. Перед вами безрисковый актив, который предлагает доходность в 8% и рисковый актив с ожидаемой ставкой доходности в 14% и стандартным отклонением в 20% (фондовый индекс).</li>
</ul>
<p>Какую часть от 100 тыс. рублей вам следует вложить в рисковый актив?</p>
<p>Пример расчета соотношений доходности и риска при разных долях в рисковом активе:</p>
<p><strong>Таблица. Комбинация риск/доходность для портфеля из рискового и безрискового актива</strong></p>
<table>
<colgroup>
<col width="15%" />
<col width="25%" />
<col width="28%" />
<col width="17%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th>Вариант портфеля</th>
<th>Доля портфеля в рисковом активе</th>
<th>Доля портфеля в безрисковом активе</th>
<th>Ожидаемая доходность</th>
<th>Ст. отклонение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>А</td>
<td>0%</td>
<td>100%</td>
<td>8%</td>
<td>0%</td>
</tr>
<tr class="even">
<td>Б</td>
<td>25%</td>
<td>75%</td>
<td>10%</td>
<td>5%</td>
</tr>
<tr class="odd">
<td>С</td>
<td>50%</td>
<td>50%</td>
<td>11%</td>
<td>10%</td>
</tr>
<tr class="even">
<td>E</td>
<td>75%</td>
<td>25%</td>
<td>13%</td>
<td>15%</td>
</tr>
<tr class="odd">
<td>D</td>
<td>100%</td>
<td>0%</td>
<td>14%</td>
<td>20%</td>
</tr>
</tbody>
</table>
<p>Формула для расчета ожидаемой доходности портфеля:</p>
<p><span class="math display">\[ E(r) = w E(r_s) + (1-w)r_f = r_f + w[E(r_s) - r_f] \]</span> где <span class="math inline">\(w\)</span> – доля портфеля в рисковом активе.</p>
<p>Если вы выразим <span class="math inline">\(w\)</span>, тогда получим</p>
<p><span class="math display">\[w = \frac{E(r) - r_f}{E(r_s) - r_f}\]</span> Стандартное отклонение портфеля, состоящего из безрискового актива и рискового актива, равно произведению стандартного отклонения рискового актива на его долю в портфеле.</p>
<p><span class="math display">\[\sigma = \sigma_s w \]</span></p>
</div>
<div id="---------" class="slide section level2">
<h2>Кривая риск/доходность - портфель из безрискового и рискового активов</h2>
<p>Построим в R график риск/доходность портфеля для разных вариантов w:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rf =<span class="st"> </span><span class="fl">0.08</span> <span class="co"># безрисковая доходность </span>
r1 &lt;-<span class="st"> </span><span class="fl">0.14</span> <span class="co"># доходность рискового актива</span>
sd1 &lt;-<span class="st"> </span><span class="fl">0.20</span> <span class="co"># ст. отклонение рискового актива</span>
w &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">200</span>)

r_p &lt;-<span class="st"> </span>w<span class="op">*</span>r1 <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>w)<span class="op">*</span>rf
sd_p &lt;-<span class="st"> </span>w<span class="op">*</span>sd1

<span class="kw">plot</span>(sd_p, r_p, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.14</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.20</span>),  <span class="dt">xaxs=</span><span class="st">&quot;i&quot;</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>,<span class="dt">lwd =</span> <span class="dv">2</span>,
     <span class="dt">main =</span> <span class="st">&#39;Кривая риск/доходность - портфель из безрискового и рискового активов&#39;</span>,
     <span class="dt">xlab =</span> <span class="st">&#39;Стандартное отклонение портфеля&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Доходность портфеля&#39;</span>)</code></pre></div>
<p><img src="lecture-7_files/figure-slidy/unnamed-chunk-1-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>Соотношение риск/доходность для портфеля из безрискового актива и рискового актива предоставляет собой прямую линию.</p>
<p>Пересечение линии с нулем по оси х – безрисковая ставка Наклон линии – <span class="math inline">\(\frac{E(r_s)-r_f}{\sigma_s}\)</span>.</p>
<p>Угол наклона кривой характеризует <strong>дополнительную ожидаемую доходность</strong>, предлагаемую рынком для каждой дополнительной единицы риска, которую согласен нести инвестор.</p>
</div>
<div id="----" class="slide section level2">
<h2>Портфель из двух рисковых активов</h2>
<p>Рассмотрим ситуацию, когда в портфеле есть два вида рисковых активов.</p>
<p>В этом случае необходим анализ соотношения риск/доходность портфеля (в прошлый раз мы считали, что риск безрискового актива равен нулю).</p>
<p>Ожидаемая доходность портфеля будет равна:</p>
<p><span class="math display">\[ E(r) = w E(r_1) + (1-w) E(r_2) \]</span> формула дисперсии будет выглядеть следующим образом:</p>
<p><span class="math display">\[\sigma^2 = w^2\sigma_1^2 + (1-w)^2\sigma_2^2 + 2w(1-w)\rho \sigma_1 \sigma_2 \]</span> (её можно вывести из обычного определения дисперсии).</p>
</div>
<div id="-" class="slide section level2">
<h2>Преимущества диверсификации</h2>
<p><strong>Важно: дисперсия портфеля зависит от корреляции между активами, в то время как ожидаемая доходность не зависит от нее</strong>.</p>
<p>Если мы предположим, что <span class="math inline">\(\rho = 1\)</span>, тогда</p>
<p><span class="math display">\[\sigma = w \sigma_1 + (1-w) \sigma_2 \]</span> То есть, риск портфеля является взвешенной комбинацией рисков актива 1 и актива 2.</p>
<p>Однако в реальности <span class="math inline">\(\rho &lt; 1\)</span>. Это означает, что риск портфеля будет <strong>меньше</strong> средневзвешенной комбинации рисков отдельных активов в портфеле. Это и есть преимущества <strong>диверсификации</strong> – возможность уменьшить риск без снижения ожидаемой доходности.</p>
</div>
<div id="-------" class="slide section level2">
<h2>Распределение ожидаемых доходностей для рисковых активов двух видов</h2>
<p>Пусть у нас имеется два рисковых актива (1 и 2). Параметры распределения их доходностей представлены в таблице:</p>
<p><strong>Таблица. Распределение ожидаемых доходностей для рисковых активов двух видов</strong></p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Актив 1</th>
<th>Актив 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cреднее</td>
<td>0,14</td>
<td>0,08</td>
</tr>
<tr class="even">
<td>Стандартное отклонение</td>
<td>0,20</td>
<td>0,15</td>
</tr>
<tr class="odd">
<td>Корреляция</td>
<td>0,00</td>
<td>0,00</td>
</tr>
</tbody>
</table>
<p>Рассмотрим соотношение риск/доходность для портфеля, который состоит из активов 1 и 2 в разных соотношениях.</p>
<p>** Таблица. Риск-доходость портфеля при разных соотношениях рисковых активов в портфеле**</p>
<table>
<thead>
<tr class="header">
<th>Портфель</th>
<th>Доля в активе 1</th>
<th>Доля в активе 2</th>
<th>Ожидаемая доходность</th>
<th>Ст. отклонение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>А</td>
<td>0</td>
<td>100%</td>
<td>0,0800</td>
<td>0,1500</td>
</tr>
<tr class="even">
<td>Б</td>
<td>25%</td>
<td>75%</td>
<td>0,0950</td>
<td>0,1231</td>
</tr>
<tr class="odd">
<td>min variance</td>
<td>36%</td>
<td>64%</td>
<td>0,1016</td>
<td>0,1200</td>
</tr>
<tr class="even">
<td>С</td>
<td>50%</td>
<td>50%</td>
<td>0,1100</td>
<td>0,1250</td>
</tr>
<tr class="odd">
<td>D</td>
<td>100%</td>
<td>0%</td>
<td>0,1400</td>
<td>0,2000</td>
</tr>
</tbody>
</table>
</div>
<div id="-------" class="slide section level2">
<h2>Кривая риск/доходность для портфеля из двух рисковых активов</h2>
<p>Построим кривую риск-доходность для такого портфеля в R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r1 &lt;-<span class="st"> </span><span class="fl">0.14</span>
r2 &lt;-<span class="st"> </span><span class="fl">0.08</span>
sd1 &lt;-<span class="st"> </span><span class="fl">0.20</span>
sd2 &lt;-<span class="st"> </span><span class="fl">0.15</span>
rho &lt;-<span class="st"> </span><span class="dv">0</span>

w &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">length.out =</span> <span class="dv">500</span>)
r_p2 &lt;-<span class="st"> </span>w<span class="op">*</span>r1 <span class="op">+</span>(<span class="dv">1</span><span class="op">-</span>w)<span class="op">*</span>r2
sd_p2 &lt;-<span class="st"> </span><span class="kw">sqrt</span>(w<span class="op">^</span><span class="dv">2</span><span class="op">*</span>sd1<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>w)<span class="op">^</span><span class="dv">2</span><span class="op">*</span>sd2<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>w<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>w)<span class="op">*</span>rho<span class="op">*</span>sd1<span class="op">*</span>sd2)

<span class="kw">plot</span>(sd_p2, r_p2,<span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.21</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">0.0575</span>, <span class="fl">0.145</span>),  <span class="dt">xaxs=</span><span class="st">&quot;i&quot;</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>,<span class="dt">lwd =</span> <span class="dv">2</span>,
     <span class="dt">main =</span> <span class="st">&#39;Кривая риск/доходность - портфель из двух рисковых активов&#39;</span>,
     <span class="dt">xlab =</span> <span class="st">&#39;Стандартное отклонение портфеля&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Доходность портфеля&#39;</span>)
<span class="kw">points</span>(<span class="dt">x =</span> <span class="fl">0.12</span>, <span class="dt">y =</span> <span class="fl">0.1016</span>, <span class="dt">pch =</span> <span class="dv">19</span>)
<span class="kw">text</span>(<span class="dt">x =</span> <span class="fl">0.12</span>, <span class="dt">y =</span> <span class="fl">0.1016</span>, <span class="dt">labels =</span> <span class="st">&#39;Портфель с минимальной дисперсией&#39;</span>, <span class="dt">adj =</span> <span class="op">-</span><span class="fl">0.1</span>)</code></pre></div>
<p><img src="lecture-7_files/figure-slidy/unnamed-chunk-2-1.png" width="1152" style="display: block; margin: auto;" /></p>
<ul>
<li>Самая левая точка этого множества – <strong>портфель с минимальной дисперсией</strong> (<strong>minimum variance portfolio</strong>)</li>
<li>Точки на кривой, которые имеют ожидаемую доходность не меньше чем у портфеля с минимальной дисперсией, составляют <strong>эффективную границу</strong> (effective frontier)</li>
<li>Портфели, которые находятся на эффективной границе, называются <strong>эффективными портфелями</strong>.</li>
</ul>
</div>
<div id="---" class="slide section level2">
<h2>Оптимальная комбинация рискованных активов</h2>
<p>Теперь рассмотрим комбинации риск/доходность в ситуации, когда мы можем объединить безрисковый актив и активы 1 и 2.</p>
<p><img src="lecture-7_files/figure-slidy/unnamed-chunk-3-1.png" width="1152" style="display: block; margin: auto;" /></p>
<ul>
<li>Точка пересечения прямой линии и кривой эффективного портфеля (T) является <strong>оптимальной комбинацией рискованных активов</strong>. Ее также называют <strong>тангенциальным портфелем</strong> (<strong>tangency portfolio</strong>).</li>
</ul>
<p>В нашем случае это точка, которой соответствует w = 69,23% (доля рискованного актива 1) в портфеле. Это означает, что для такого портфеля: <span class="math inline">\(E(r_p) = 0,122\)</span>, а <span class="math inline">\(\sigma = 0,146\)</span>.</p>
<ul>
<li><strong>Точка F</strong> – доходность безрискового актива</li>
<li><strong>R1, R2</strong> – портфели состоящие из полностью из актива 1 или актива 2</li>
<li>Красным выделена эффективная граница. Портфели которые находятся на ней – эффективные, портфели, которые находятся на черной линии - не эффективны.</li>
<li>P – типичный портфель, который находится на эффективной границе (эффективный портфель)</li>
</ul>
</div>
<div id="-" class="slide section level2">
<h2>Показатель Шарпа</h2>
<ul>
<li>Обратите внимание, что голубая линии, которая соединяет точку F и T лежит выше пурпурной линии, которая соединяет точку F и типичный портфель. Это означает, что для каждого значения <span class="math inline">\(\sigma_p\)</span> – голубая линия дает лучшее соотношение риск-доходность, чем пурпурная.</li>
<li>Угол наклона каждой линии, которая проходит через точку F и точку на кривой – является <strong>“показателем Шарпа”</strong> (Sharpe ratio)</li>
</ul>
<p>Показатель Шарпа равен:</p>
<p><span class="math display">\[\frac{E(R_p) - r_f}{\sigma_p} \]</span></p>
<ul>
<li>по сути показатель Шарпа представляет собой <strong>вознаграждение за риск</strong>.</li>
<li>Любая линия, которая имеет больший угол наклона (показатель Шарпа), обеспечивает более высокий уровень ожидаемой доходности для заданного уровня риска. Поэтому чем выше показатель Шарпа, тем лучше – неважно, какой уровень риска вы хотите принять.</li>
<li>Точка T будет иметь максимальное значение показателя Шарпа.</li>
</ul>
</div>
<div id="------" class="slide section level2">
<h2>Оптимальный портфель из безрискового и рисковых активов</h2>
<ul>
<li>Оптимальный (эффективный) портфель из безрискового и рисковых активов сочетает тангенциальный портфель и безрисковый актив.</li>
<li>Эффективный портфель имеет более высокое ожидаемое значением по сравнению с другими портфелями, которые имеют такое же или меньшее значение риска</li>
<li>Эффективный портфель имеет меньший уровень риска по сравнению с другими портфелями, которые имеют аналогичное или большее значение доходности</li>
</ul>
</div>
<div id="-----" class="slide section level2">
<h2>Влияние корреляции на уровень риска портфеля</h2>
<ul>
<li>Положительная корреляция между активами увеличивает риск портфеля, отрицательная корреляция - уменьшает риск. Посмотрим на изменение точки T (тангенциальный портфель) при разных значениях корреляции рисковых активов:</li>
</ul>
<p><img src="lecture-7_files/figure-slidy/unnamed-chunk-4-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="-----" class="slide section level2">
<h2>Эффективный портфель со множестом рисковых активов</h2>
<ul>
<li>В общем случае у нас может быть множество рисковых активов с разными характеристиками риск-доходности. В матричном виде это означает, что мы минимизируем следующее выражение:</li>
</ul>
<p><span class="math display">\[w^T \Sigma w - q R^Tw \rightarrow min\]</span> где</p>
<ul>
<li><span class="math inline">\(w\)</span> – вектор весов портфеля, такой что (<span class="math inline">\(\Sigma w_i = 1\)</span>)</li>
<li><span class="math inline">\(\Sigma\)</span> – матрица ковариаций активов</li>
<li><span class="math inline">\(q \geq 0\)</span> – фактор склонности к риску, такой что при q= 0 мы предпочитаем минимальный риск, при <span class="math inline">\(q -&gt; \infty\)</span> мы готовы идти на неограниченный риск.</li>
<li><span class="math inline">\(R\)</span> – вектор доходностей активов</li>
<li><span class="math inline">\(w^T \Sigma w\)</span> – дисперсия доходностей портфеля</li>
<li><span class="math inline">\(R^T\)</span> – ожидаемая доходность портфеля.</li>
</ul>
<p>Мы можем использовать численные методы, чтобы найти оптимальные значения весов. Обычно используют методы <strong>квадратичного программирования</strong>, которые позволяют находить экстремумы квадратичных функций при заданных линейных ограничениях. В R можно использовать функцию <code>solve.QP</code> из пакета <code>quadprog</code>.</p>
</div>
<div id="-------" class="slide section level2">
<h2>Портфель – Газпром, Сбербанк и Норникель, Магнит и МТС</h2>
<p>Рассмотрим портфель из акций 5 российских компаний из разных отраслей.</p>
<pre><code>
Attaching package: &#39;PerformanceAnalytics&#39;</code></pre>
<pre><code>The following object is masked from &#39;package:graphics&#39;:

    legend</code></pre>
<pre><code>Loading required package: data.table</code></pre>
<pre><code>
Attaching package: &#39;data.table&#39;</code></pre>
<pre><code>The following objects are masked from &#39;package:xts&#39;:

    first, last</code></pre>
<p><img src="lecture-7_files/figure-slidy/unnamed-chunk-5-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>Примечание: в данном случае мы не учитываем выплаченне дивиденды в доходностях.</p>
</div>
<div id="--" class="slide section level2">
<h2>Доходность и риск</h2>
<p>Рассчитаем показатели доходности и риска (стандартного отклонения) с помощью функций из пакета <code>PerformanceAnalytics</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(PerformanceAnalytics)
<span class="kw">Return.annualized</span>(rtns, <span class="dt">geometric =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>                        GAZP       SBER      GMKN      MGNT       MTSS
Annualized Return -0.0646035 0.09180286 0.1107629 0.1343745 0.01099859</code></pre>
<p>Максимальная доходность (% в год) у Магнита (11,0%), у Газпрома – средняя отрицательная доходность за период (-6,4%).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">StdDev.annualized</span>(rtns, <span class="dt">geometric =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>                                   GAZP      SBER      GMKN      MGNT
Annualized Standard Deviation 0.3665802 0.4663409 0.4182419 0.3743876
                                   MTSS
Annualized Standard Deviation 0.3676073</code></pre>
<p>Показатели риска максимальны у акций Сбербанка (47,0%), минимальны – у акций Магнита.</p>
</div>
<div id="-" class="slide section level2">
<h2>График риск/доходность</h2>
<p>Отобразим полученные сочетания риск-доходность для 5 бумаг на графике:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span><span class="kw">Return.annualized</span>(rtns, <span class="dt">geometric =</span> <span class="ot">FALSE</span>)
sd &lt;-<span class="st"> </span><span class="kw">StdDev.annualized</span>(rtns, <span class="dt">geometric =</span> <span class="ot">FALSE</span>)
tab &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">round</span>(<span class="kw">as.numeric</span>(r),<span class="dv">2</span>),<span class="kw">round</span>(<span class="kw">as.numeric</span>(sd),<span class="dv">2</span>), <span class="kw">names</span>(rtns))
tab &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(tab)
tab[,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>((tab[,<span class="dv">1</span>])))
tab[,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>((tab[,<span class="dv">2</span>])))
<span class="kw">names</span>(tab) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Доходность&#39;</span> ,<span class="st">&#39;Волатильность&#39;</span>, <span class="st">&#39;Тикер&#39;</span>)

<span class="kw">require</span>(ggplot2)</code></pre></div>
<pre><code>Loading required package: ggplot2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tab, <span class="kw">aes</span>(<span class="dt">x =</span> Волатильность, <span class="dt">y =</span> Доходность, <span class="dt">label =</span> Тикер))
p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_text</span>(<span class="dt">check_overlap =</span> <span class="ot">TRUE</span>, <span class="dt">vjust  =</span> <span class="op">-</span><span class="dv">1</span>)<span class="op">+</span>
<span class="st">   </span><span class="kw">theme_bw</span>()<span class="op">+</span>
<span class="st">   </span><span class="kw">ggtitle</span>(<span class="st">&#39;Cоотношение риск/доходность для 5 бумаг&#39;</span>)</code></pre></div>
<p><img src="lecture-7_files/figure-slidy/unnamed-chunk-8-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="-" class="slide section level2">
<h2>Матрица ковариаций</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cov</span>(rtns)</code></pre></div>
<pre><code>             GAZP         SBER         GMKN         MGNT         MTSS
GAZP 0.0005332580 0.0004839621 0.0003747466 0.0001794604 0.0003449180
SBER 0.0004839621 0.0008629914 0.0004250098 0.0002345590 0.0004234389
GMKN 0.0003747466 0.0004250098 0.0006941519 0.0001708417 0.0003098085
MGNT 0.0001794604 0.0002345590 0.0001708417 0.0005562146 0.0001829457
MTSS 0.0003449180 0.0004234389 0.0003098085 0.0001829457 0.0005362506</code></pre>
<ul>
<li>Матрицы ковариаций показывают попарные значения ковариаций в портфеле</li>
<li>Эти матрицы являются одним из основных элементов при портфельном анализе, однако сами по себе достаточно трудны для восприятия</li>
<li>Для оценки связи между переменными лучше использовать матрицы корреляций</li>
</ul>
</div>
<div id="-" class="slide section level2">
<h2>Матрица корреляций</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(rtns)</code></pre></div>
<pre><code>          GAZP      SBER      GMKN      MGNT      MTSS
GAZP 1.0000000 0.7134104 0.6159448 0.3295176 0.6450053
SBER 0.7134104 1.0000000 0.5491215 0.3385538 0.6224488
GMKN 0.6159448 0.5491215 1.0000000 0.2749448 0.5077878
MGNT 0.3295176 0.3385538 0.2749448 1.0000000 0.3349787
MTSS 0.6450053 0.6224488 0.5077878 0.3349787 1.0000000</code></pre>
<ul>
<li>Наибольшие значения корреляций наблюдаются для Газпрома и Сбербанка, минимальные значения корреляций - для Норникеля и Магнита.</li>
<li>Между всеми бумагами наблюдается достаточно сильная корреляция</li>
</ul>
</div>
<div id="---" class="slide section level2">
<h2>Расчет эффективной границы портфеля</h2>
<ul>
<li>Мы используем функция <code>eff.frontier</code>, которая позволяет находить веса бумаг, максмизирующая показатель Шарпа портфеля.</li>
<li>Она также позволяет задавать ограничения на значения весов. Если не допускается существование коротких позиций в портфеле, то каждый из весов должен быть больше или равен 0.</li>
<li>Мы также можем задать максимальную долю одной бумаги в портфеле (аргумент <code>max.allocation</code>), с тем, чтобы уменьшить концентрацию портфеля.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eff &lt;-<span class="st"> </span><span class="kw">eff.frontier</span>(<span class="dt">returns=</span>rtns, <span class="dt">short=</span><span class="st">&quot;no&quot;</span>, <span class="dt">max.allocation=</span>.<span class="dv">50</span>,
                    <span class="dt">risk.premium.up=</span><span class="dv">10</span>, <span class="dt">risk.increment=</span>.<span class="dv">01</span>)

<span class="kw">head</span>(eff)</code></pre></div>
<pre><code>       GAZP          SBER      GMKN      MGNT      MTSS   Std.Dev
1 0.2142635  0.000000e+00 0.1446091 0.3882067 0.2529207 0.2863376
2 0.1941092 -1.387779e-17 0.1565946 0.3966200 0.2526762 0.2864032
3 0.1739549  0.000000e+00 0.1685801 0.4050332 0.2524317 0.2866000
4 0.1538007  0.000000e+00 0.1805656 0.4134465 0.2521872 0.2869275
5 0.1336464  6.938894e-18 0.1925511 0.4218597 0.2519427 0.2873855
6 0.1134922 -6.938894e-18 0.2045366 0.4302730 0.2516982 0.2879732
  Exp.Return    sharpe
1 0.05712202 0.1994918
2 0.06087944 0.2125655
3 0.06463686 0.2255299
4 0.06839428 0.2383678
5 0.07215170 0.2510624
6 0.07590913 0.2635978</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the optimal portfolio</span>
eff.optimal.point &lt;-<span class="st"> </span>eff[eff<span class="op">$</span>sharpe<span class="op">==</span><span class="kw">max</span>(eff<span class="op">$</span>sharpe),]
<span class="kw">round</span>(eff.optimal.point,<span class="dv">2</span>)</code></pre></div>
<pre><code>   GAZP SBER GMKN MGNT MTSS Std.Dev Exp.Return sharpe
82    0 0.06 0.44  0.5    0    0.31       0.12   0.39</code></pre>
<ul>
<li>Эффективный портфель – тот, который имеет максимальное значения показатель Шарпа.</li>
<li>В нашем случае это портфель, который состоит из 44% Сбербанк, 27% Норникеля и 50% Магнита.</li>
<li>Обратите внимание, что доля Магнита равно максимальной доле (выставленное ограничение)</li>
</ul>
</div>
<div id="-" class="slide section level2">
<h2>Эффективная граница</h2>
<p>График эффективной границы</p>
<pre><code>Warning: Ignoring unknown aesthetics: label</code></pre>
<p><img src="lecture-7_files/figure-slidy/unnamed-chunk-13-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>Отметим отдельные бумаги на графике:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">data =</span> tab, <span class="kw">aes</span>(<span class="dt">x=</span> Волатильность, <span class="dt">y =</span> Доходность))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> tab, <span class="kw">aes</span>(<span class="dt">x=</span> Волатильность, <span class="dt">y =</span> Доходность,<span class="dt">label =</span> Тикер), <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>)</code></pre></div>
<p><img src="lecture-7_files/figure-slidy/unnamed-chunk-14-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="----" class="slide section level2">
<h2>Эффективный портфель с короткими позициями</h2>
<p>Рассмотрим эффективный портфель, в котором разрешены короткие позиции. Это означает, что некоторые веса могут быть отрицательными.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eff2 &lt;-<span class="st"> </span><span class="kw">eff.frontier</span>(<span class="dt">returns=</span>rtns, <span class="dt">short=</span><span class="st">&quot;yes&quot;</span>, <span class="dt">max.allocation=</span>.<span class="dv">50</span>,
                    <span class="dt">risk.premium.up=</span><span class="dv">10</span>, <span class="dt">risk.increment=</span>.<span class="dv">01</span>)

<span class="co"># Find the optimal portfolio</span>
eff.optimal.point2 &lt;-<span class="st"> </span>eff2[eff2<span class="op">$</span>sharpe<span class="op">==</span><span class="kw">max</span>(eff2<span class="op">$</span>sharpe),]
<span class="kw">round</span>(eff.optimal.point2,<span class="dv">2</span>)</code></pre></div>
<pre><code>    GAZP SBER GMKN MGNT MTSS Std.Dev Exp.Return sharpe
73 -0.98  0.5  0.5  0.5 0.48    0.41       0.24   0.57</code></pre>
<p>Оптимальный портфель с короткими позициями предлагает нам занять короткую позицию по Газпром в размере всего портфеля (-98%), все остальные бумаги имеют примерно в равных долях.</p>
</div>
<div id="-----" class="slide section level2">
<h2>Риск-доходность портфеля с короткими позициями</h2>
<pre><code>Warning: Ignoring unknown aesthetics: label</code></pre>
<p><img src="lecture-7_files/figure-slidy/unnamed-chunk-16-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>Разрешение занимать короткие позиции позволило повысить доходность портфеля, но и повысило уровень риска. Однако к-т Шарпа для этого портфеля больше (0,77 вместо 0,63).</p>
</div>
<div id="-----" class="slide section level2">
<h2>Ограничение оптимизации портфелей по риск-доходности</h2>
<ol style="list-style-type: decimal">
<li>Все оценки доходности и риска, которые мы делали, основывались на <strong>исторических данных</strong>. Мы использовали выборочные значения доходностей, дисперсий и ковариационной матрицы (корряляции активов) и предполагали, чтоб они хорошо отражают ожидаемые значения. Это достаточно большое количетсво параметров. Как показывает практика, классифические портфели по Марковицу, максимизирующие показатель Шарпа, являются нестабильными. Существуют другие методы, которые позволяют оценивать ковариационную матрицу, к примеру, <strong>метод Ледуа-Вульфа</strong> ( <em>Ledoit-Wolf, 2003</em> ). По сути это shrinkage метод, который “стабилизирует ковариационную матрицу – возвращает экстремальные значения корряляций к центральным значениям.</li>
<li>Можно также использовать другие методы для оценок ожидаемых доходностей вместо выборочных исторических доходностей. Одним из таких методов является <strong>метод Джеймса-Стайна</strong> ( <em>James–Stein estimator, 1961</em>), который также основан на идее shrinkage.<br />
</li>
<li>В классическом варианте оптимизации по Марковицу, мы предполагаем, что <strong>доходности имеют нормальное распределение</strong> – полностью описываются средним и стандартным отклонением. Однако мы знаем, что доходности не распределены нормально. Есть методы, которые позволяют обойти эти ограничения.</li>
</ol>
</div>
<div id="---etf----" class="slide section level2">
<h2>Оптимальный портфель из ETF, торгующихся на Московской Бирже</h2>
<ul>
<li>портфели доступны и регулярно обновляются на <a href="http://models.fief.ru/shiny/portfolio/" class="uri">http://models.fief.ru/shiny/portfolio/</a></li>
<li>На Москоской Бирже есть торгуемые биржевые фонды (ETF), доходность которых призвана повторять доходность различных российских и международных биржевых индексов. Преимущества - позволяет “не выбирать” отдельные активы и следить за ними, ниже издержки по сравнению с ПИФами, удобство ликвидности.</li>
<li>Оценка out-of-sample доходностей различных оптимальных инвестиционных инвестиционных портефелей.</li>
</ul>
<p><strong>Global Minimum Variance Portfolio (GMVP)</strong> – портфель, минимизирующий риск портфеля.</p>
<p><strong>Maximum Sharpe Ratio Portfolio (MSRP)</strong> – портфель, максимизирующий доходность портфеля, скорректированную на его риск (по Марковицу).</p>
<div align="center">
<p><img src="fig/portfolio-etf.png" width="653" height="496" /></p>
</div>
</div>
<div id="c--" class="slide section level2">
<h2>Cписок использованных источников</h2>
<ol style="list-style-type: decimal">
<li>“Statistics and Data Analysis for Financial Engineering” (David Ruppert &amp; David Matteson)</li>
<li>Analyzing Financial Data and Implementing Financial Models Using R (Clifford Ang).</li>
<li><a href="(http://economistatlarge.com/portfolio-theory/introduction-to-portfolio-theory)">“Introduction to Modern Portfolio Theory”</a></li>
<li><a href="https://faculty.washington.edu/ezivot/econ424/portfoliofunctions.pdf">“Computing Efficient Portfolios”</a> (Eric Zivot)</li>
<li><a href="http://www.ledoit.net/honey.pdf">Ledoit, Olivier, and Michael Wolf. “Honey, I shrunk the sample covariance matrix.” (2003).</a></li>
</ol>
</div>

  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

</body>
</html>
